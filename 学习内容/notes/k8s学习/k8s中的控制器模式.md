# k8s控制器模式

在K8s中 操作集装箱的逻辑都是由控制器来完成的。

在K8s中常用的Deployment就是一种控制器。

## kube-controller-manager

![容器初探学习架构图](http://jikelearn.cn/2019-06-05-23-23-36.png)

如图所示。

k8s中控制器有很多类型，其中Deployment,正是其中的一种。控制器采用一种通用编排模式，既循环控制。

判断集群中对象的实际状态与期望状态。

### 实际状态

实际状态往往来自于Kubernetes集群本身。控制器主动去搜集自己感兴趣的信息，来获取集群中实际的状态信息。

### 期望状态

期望状态往往都是用户提交的yaml文件的值，这些内容往往会保存在Etcd中。

### 编排动作

在Kubernetes对象的主要编排逻辑是依赖于**对比**操作完成的。

这个操作一般叫做协调，可以被称为是协调循环（Reconcile Loop）或者Sync Loop 同步循环。

### 模板

![2019-06-09-01-14-08](http://jikelearn.cn/2019-06-09-01-14-08.png)

上半部分是控制器定义包含期望状态，则下半部分是被控制器对象的模板组成。

