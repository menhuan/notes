# 分区表

分表与分区表是两个不同的概念，分区表是数据库中的一种概念，分表是用业务中间件来进行分表。

## 分区表是什么？

按照一定规则的分区进行创建的表。

- 对于引擎层的来说，是多个表。
- 对于Server来说是一个表。

分区表会形成一个.frm文件与多个.ibd文件，每个分区对应一个.ibd文件。

## 分区表的引擎行为

### InnoDB 引擎行为

分区表在引擎层是不同的表，所以在插入的数据的时候，锁的间隙是不同的。每个分区表锁自己的间隙区，跟其他分区表不想关。

### MyISAM

MyISAM 表只支持表锁，所以语句会锁整个表，将整个分区进行锁上，导致堵住不能 执行。

### 手动表与分区表区别

手动分表：由应用代码来决定使用哪个分区。

分区表: 由Server 层决定使用哪个分区表。

## 分区策略

分区表最大的诟病就是访问一个分区表的时候 **MySQL会把所有的分区都访问一遍**，

### MyISAM引擎

还有个问题是MySQL 设置open_files_limit 大小默认是1024 ，超过这个限制就会报错。

### 本地分区策略

InnoDB 与 NDB 两个引擎 采用的是本地分区策略，内部自己管理打开的分区行为

## 分区Server层行为

- MySQL 第一次打开分区表的时候，需要访问所有分区。
- server层，认为是同一张表，所有分区公用一个MDL锁。
- 引擎层，不同的表，根据不同的分区规则，只访问必要的分区。 规则是根据查询条件与分区条件来确定的，如果没有查询条件对应上分区的规则，那么就访问所有分区。
  
