
![M有SQL的基本架构示意图](https://upload-images.jianshu.io/upload_images/4237685-36874ff4db6f8d4d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
主要分为Server层与存储引擎层两部分 。

Server层包含连接器，查询缓存，分析器，优化器，执行器，包含所有的内置函数日期，时间，数学，加密函数,所有跨存储引擎功能在这实现包含存储过程，触发器，视图等。

存储引擎负责数据的存储与提取，架构支持插件形式。
# 连接器
连接器负责跟客户端建立连接，获取权限，维持和管理连接。

管理员对权限进行修改后，不会影响到已经存在的链接权限，新建立的了解才会使用新的权限设置。

客户端长时间没有动静，连接器会将其断开，时间由wait_timeout控制，默认8小时。

长链接：链接成功后，客户端持续有请求，则一直使用同一个链接。
短连接：每次执行玩很少的查询就断开连接，下次查询再建立一个连接。

长链接，容易导致内存飞涨。MySQL使用的是临时内存管理连接对象。
- 定期断开长链接。
- MySQL5.7以上版本，执行一个比较大的操作后，执行mysql_reset_cvonnection来重新舒适化连接资源。会恢复到刚刚创建完成时的状态。

# 查询缓存
8.0版本以后不存在。
查询连接器连接好之后，会先查询缓存存不存在，存在使用缓存。
缓存是按照k-v形式 存在。k 是查询的语句，v是查询结果。
不建议使用缓存，对一个表进行更新，表上所有查询缓存都要被清空。
缓存可以进行按需开启，多余大部分不用更新的表来说，可以采用缓存的方式进行存储。
# 分析器
对SQL语句进行分析，首先进行词法分析，MySQL需要识别出来里面的字符串代表什么。
- 分析字符串 关键字，表名，列名等信息。
- 语法分析,根据词法分析的结果，进行语法规则分析，是否输入的SQL语句满足MySQL的语法。
语法错误会在分析器这里提示。
# 优化器
优化器帮助选择表中的索引，关联查询的时候决定表的链接顺序等等。
# 执行器
执行SQL语句。
- 首先判断表是否有权限，有权限就继续执行，没有权限就失败。
- 根据执行表的索引或者没有索引进行执行。
 1. 无索引
    -  调用InnoDB引擎接口读取表的第一行，进行判断。容易导致全表扫描。如果存在就存到结果集中，没有就继续读取下一行直至读取到表的最后一行。返回结果集给客户端。
 2. 有索引
    - 调用InnoDB引擎读取满足条件的第一行这个接口，循环调取满足条件的下一行。接口是在引擎中定义好的。
- 执行器调用一次，内部扫描了很多行，引擎扫描行数与rows_examined不是完全相同。


