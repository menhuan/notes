# 容器网络

网络栈包含：网卡，回环设备，路由表和Iptables规则。构成发起和响应网络请求的基本环境。

当然容器也可以直接使用宿主机的网络 -net= host在启动的时候即可。

## 容器网络交互

大多数情况下，我们希望容器进程都能使用自己的Network Namespace 里的网络栈，拥有自己的IP地址和断就。

但容器怎么与其他网络进程交互呢？

Linux中起到虚拟交换机作用的网络设备是网桥，工作在数据链路层的设备，主要是根据MAC地址学习来讲数据包转送到网桥不同端口上。

### docker0

Docker的项目会在宿主机上创建一个名叫docker0的网桥。链接docker0网桥上的容器都是通过其来进行同行。

怎么把容器链接到网桥上呢？ 就是通过一个名叫Veth Pair的虚拟设备。

特点是创建后，会按照两张虚拟网卡的形式成对出现。从一个网卡发送出来数据，另外一个网卡接受数据。即使是在不同的NetWork Namespace 中也是可以的。

#### 查看方式

1. 进入到对应的docker容器中 exec .
2. ifconfig 命令查看，一般eth0网卡即是我们找到的veth pair设备网卡。
3. route 命令查看路由规则。
4. 在宿主机上查看ifconfig
5. brctl show 查看网桥绑定的虚拟网卡。

#### 流程

虚拟网卡插在网桥上，就会变成网桥的从设备，从设备会被剥夺调用网络协议栈处理数据包的资格，只是一个网桥上的端口。

网桥接受ARP请求，docker0网桥扮演二层交换机的角色，把ARP广播转发到插入到该docker0虚拟网卡上。从而将MAC地址回复给发送的数据端， 有了MAC地址数据端就可以将数据发送出去了。

