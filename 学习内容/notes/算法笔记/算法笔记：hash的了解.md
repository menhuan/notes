# hash

hash算法：将任意长度的二进制串映射为固定长度的二进制值串，映射的规则就是**hash算法**。

映射之后的二进制值串就是哈希值。

## Hash 算法需要满足的条件

以下几点要求。

- 从哈希值不能反向推导出原始数据
- 对输入数据敏感，原始数据修改了一个Bit,最后得到的Hash值大小不同。
- 散列冲突的概率比较小，不同的原始数据，hash值概率比较小
- hash算法的效率高效，长文本的内容计算时间也要短。

## Hash算法的主要应用

### 安全加密

在账户系统中，我们经常使用md5加密或者SHA安全算法加密当然还有其他类型加密算法。入DES，AES算法。

#### 鸽子理论

有10个鸽巢，11个鸽子，百分百存在有一个鸽巢存在两个鸽子，就出现了冲突这一说。

### 唯一标识

图片上的成千上万的图片进行摘要计算，保证数据的唯一，进行散列求值。

### 数据校验

在我们dcm数据下载采用多线程下载，为保证数据下载的数据能最后拼接成一个完整的视频，为对每一段的数据进行hash计算，最后下载完的分片文件与服务器上面计算的hash值进行对比，是否完全一致，不一致需要再重新下载。

### 散列函数

散列函数是哈希算法的一种应用，决定散列冲突的概率和散列表的性能。

下面三个是跟分布式系统有关的

### 负载均衡

负载均衡在算法中有轮训，随机，加权访问等内容。

在ngnix中就用到这些负载均衡算法。我们平常开发中可能会用到的是根据不同的机器访问特定的服务器对机器数据量进行取模运算，计算出来的值就是机器的编号，这样就让数据直接访问对应的机器即可。

### 数据分片

哈希算法可以进行数据的分片。常见的面试题有这样的。

#### 面试题1

有一个10g的数据，需要快速的处理文件按照里面的内容分配到相应的机器上，有五台机器，内存1G。 可以写一个程序读取文件内容进行hash计算，对机器数量进行取模，分配到对应的机器上处理数据即可。

#### 判断图片是否在图库中

还是多台机器处理，将图片计算一个hash值，分找到对应的机器，去具体的机器上找到相应的散列表查看是否有图片。在这里利用是多台机器创建自己的散列表，将各个机器的内存使用起来。

这样可以突破单台机器的内存，CPU等资源的限制

#### 分布式存储

分布式文件存储，我们大多数听说过hdfs,Hadoop,对象存储S3等内容。

分布式存储主要困难点在，当当前容量不够时增加机器，怎么能保证数据进行平滑的迁移。

这就需要的是**一致性哈希算法**出现了。

一致性哈希算法：，机器数量k个，数据哈希范围[0,Max]，将整个区间的内荣划分为m个小空间，其中m大于k。每个机器就负责m/k个小空间。当有新机器进来，只需要将几个小区间的内容数据迁移到新机器上。

好处是不用全部进行hash，搬移数据，也保持了各个机器之间数据的均衡。



