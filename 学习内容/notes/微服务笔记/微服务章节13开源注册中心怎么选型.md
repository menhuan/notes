#注册方案选择两种
- 应用内注册与发现。注册中心提供服务端与客户端的SDK，业务应用通过引入注册中心提供的SDK，通过SDK与注册中心交互，来实现服务的注册与发现。
- 应用外注册与发现。通过其他方式来间接的完成注册与发现。

## 应用内注册方式
有名的是Netflix 开源的Eureka。

 1. 其中 Eureka 作为注册的服务端 实现服务信息的注册，存储以及查询功能。
 2. 服务端的提供者有sdk，这个sdk用来帮助服务提供者完成服务的注册与反注册（删除功能）。
 3. 客户端的消费者sdk，这个sdk用来帮助客户端的消费者完成服务的调用与订阅更新操作。
## 应用外注册方式
开源的注册中心Consul。
![架构图](https://upload-images.jianshu.io/upload_images/4237685-88ca9a0330861c52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
三个组件。
1. Consul :注册中心的服务端，完成服务注册消息的存储，发现服务等功能
2. Registrator ： 通过监听服务部署的Docker实例是否存活，来负责提供服务提供者的注册与销毁。
3. Consul Template : 定时从注册中心获取最新的服务提供者节点列表，并刷新配置。这样消费者就能通过Ngnix来获取最新的服务提供者消息。

# 注册中心选型要考虑的问题

## 高可用性
1. 集群部署，用多个机器组成集群，保证当其中一台或者多台实例挂掉之后还能有机器能够提供服务。
2.多IDC部署，防止出现硬件问题，或者不可抗拒的因素导致机器挂掉，那么还有其他机房可以用来提供服务。
![consule部署示意图](https://upload-images.jianshu.io/upload_images/4237685-5d06f3e9b3b61f48.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
## 数据一致性
保证高可用性，就会出现部署多个数据中心。那么多个数据中心如何保证数据一致性呢？
分布式中我们曾经学到过著名的CAP理论，其中C（Consistency）代表一致性，A（Availability）代表可用性。P（PartitionTolerance）分区容错性。三者之间不能同时满足。
-CP：牺牲可用性，来保证一致性与容错性。典型的方案就是Zookeeper.
-AP:牺牲一致性，保证可用性与分区容错性。典型的方案是Eureka 单独保存服务注册地址，就算网络出现问题。每台服务器也能完成任务
-CA：牺牲容错性，保证一致性与分区容错性。典型例子是Consul，Consul采用了Gossip协议来保证最终一致性。Gossip最终一致性算法，尝试解决的问题是保证每个节点最后的状态都会是一致的。具有天然的容错性。上次在听饿了吗讲座的时候他们的分布式方案也是采用的最终一致性方案。

对于注册中心来说可用性的概率比较大，出现一致性不一样的情况，可以引入其他方案来避免。因此选择CA与AP方案。
