这一节是关于负载均衡的算法介绍，我们在平常代码中也可以去使用。

# 常见的负载均衡算法

## 随机算法
从可用的服务节点中，随机选出一个节点来访问。

算法实现：根据一个随机数来访问，比如有20个节点，那么随机1-20之间的数量，编号出现10 那么就访问编号为10的节点。

算法的意义：在节点数量做够多的情况下，访问量比较大的情况下，该算法访问到的概率基本上是相同的。

## 轮询算法

轮询算法： 按照固定的顺序，把可用的节点一个个的访问一次。

实现： 把所有节点放到一个数组中，或者顺序的列表中，按照编号进行访问。

意义：保证所有的节点 被访问到的概率是相同的。一个轮询算法就可以搞定。

## 加权轮询算法

加权 轮询算法： 在轮询算法的基础上进行扩展，给每个节点增加一个权重，让性能好的节点 被访问到的概率大一些，性能差点的节点被访问的概率小点。

实现： 生成一个节点序列， 节点出现的次数，就是他自己的权重值。

意义：在使用加权轮询算法，要保证加权轮询算法均匀，不然容易造成 节点文芳的失衡。

## 最少活跃连接算法

最少活跃连接算法： 每一次的访问，都选择连接数最少的节点。

因为不同的节点处理请求速度是不一致的，使得每一个消费者同每一个节点的连接数是不相同的。

实现时：需要记录每个节点的连接数，这样才能选择出来连接数最好的节点

## 一致性hash算法

一致性hash算法：通过某个hash函数，把同一个来源的请求映射到同一个节点上。

特点是：同意而来源的请求，都能映射到一个节点服务中，当节点不可用的时候才会映射到相邻的节点上。

# 使用场景

## 随机算法

请求量远超过可用服务节点数量的情况下。哥哥服务概率基本相同。

## 轮询算法

各个随机服务节点被访问的概率相同。应用在各个节点上的情况不大。

## 加权轮询算法
在轮询算法的基础上进行修改，给每个节点设置权重，适合服务节点差异性能比较大的情况。
 
## 最少活跃连接算法
采用该算法，客户端连接服务端的节点数是在时刻变化的，在服务端的节点性能差异大又不好做预定义权重时，采用最好活跃连接算法是比较好的选择。

## 一致性hash算法
能够保证同一个客户端的请求时钟访问同一个服务节点。
适合处理服务端节点 不同请求差异比较大的场景。

## 自适应最优选择算法
该算法为解决以下问题：
- 节点数量多，且性能差异比较大；
- 节点列表经常变化，增加节点或者减少节点。
- 客户端与服务端的网络情况比较复杂，可能属于不同的数据中心，或者网络延迟情况严重的。

思路： 客户端维护一份同每一个服务节点性能的快照统计，并且每隔一段时间去更新这个快照。动态调整权重，减少访问量。达到优化长尾请求

可以看做是动态的轮询加权算法。

关键之处在于：
- 每个一段时间客户端去获取每个节点服务器的平均性能。 内存中
进行获取，时间选择适中，建议1分钟
- 按照这个性能对统计节点进行排序，对后面的20%比例的节点给一个低的权重。其余节点正常权重。权重设置差距不要太大。

