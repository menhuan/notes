微服务 程序之间调用涉及到不同机器之间的远程调用，这个过程引入了两个不确定的因素

- 服务提供者可能因为CPU,网络，内存，磁盘IO等硬件原因导致调用失败，软件可能因为gc等原因调用失败
- 网络传输是复杂的，延迟，丢包，瞬间抖动都可能造成调用失败。

#服务调用失败的处理手段
四种处理方式：超时，重试，双发，熔断
## 超时
服务调用设置超时时间：防止调用失败导致整个系统崩溃。
超时时间设置不能太长也不能太短，建议设置时间长度为线上真实水平的P999或者P9999标准。毫秒内返回为准

##重试
服务调用设置重试机制：防止因为个别网络问题或者节点问题导致调用失败的原因。
重试机制要设置重试次数，超过超时时间那么开始重试。次数也要设置量级。不然也会引起系统问题
## 双发
同时发起上次调用，但是这样容易造成系统服务两倍的压力。
采用备份请求：发起一次消费调用后，在给定的时间内没有结果，那么发起二次调用。这个时间低于超时时间建议设置为P90或者P99的时间。理论上返回的快一些。
备份请求也要设置一个最大重试比例，防止请求给服务造成更大的压力。

## 熔断

需要服务消费者能够探测到服务提供者发生的故障。短时间停止请求，给服务提供者恢复的时间。

原理：
- 把服务调用用断路器封装起来，通过断路器监控每一次调用
- 某一段时间内，服务调用失败次数达到阈值，熔断器触发。
- 后续服务调用直接返回，不再向服务提供者发起请求。

中断后怎么恢复启用？
涉及到熔断器的状态。
- Closed状态：断路器处于关闭状态。偶尔的调用失败不影响
- Open状态：达到阈值，断路器处于打开状态。服务不在提供直接返回。
- Half Open状态：开启后，每隔一段时间，进入半打开状态。发起探测作用。帮助恢复作用。成功，断路器关闭；失败，断路器继续开启。


