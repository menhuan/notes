Istio 的架构：
![架构图](https://upload-images.jianshu.io/upload_images/4237685-7e4a634079266d97.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
# Proxy
每个服务本地都会有一个Proxy服务，进行消费端的正想代理，与服务提供者的反向代理。
具有负载均衡，代理转发，限流限级，服务发现，服务注册，动态路由，日志推送等功能。
性能特点如下：
- 性能损耗低：能提供极高的吞吐量和极少的长尾延迟，对CPU和内存资源占用不大。
- 可扩展性高，具有可插拔过滤器的能力，自定义开发过滤器满足自己的需要。
- 动态可配置：对外提供统一的API，集群发现服务，路由发现服务，健康检查服务等，通过API进行配置的动态变更，不需要重启服务。

Envoy是Istio中最基础的组件，提供的API进行访问转发，进行逻辑操作。
# Pilot
进行统一的架构配置。
![image.png](https://upload-images.jianshu.io/upload_images/4237685-eb21680111c8c2b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
##流量管控操作
#### 服务发现与负载均衡
服务 启动会注册到服务中心，其他服务调用启动的服务时，会先被Proxy拦截，然后Proxy调用Pilot查询可用的节点，用负载均衡算法去调用其中的一个节点。
健康检查是定期的检查缓存中的服务节点状况，多次检查失败的节点达到阈值的情况下，会从缓存中删除。
####请求路由
对服务进行版本的区分，比如测试环境与线上环境的区分。Pilot给定一定的路由规则，让Proxy进行转发的时候进行判断转发。
#### 超时重试
HTTP链接失败访问是15s,可以根据API进行调整尝试的时间。当然重试次数也可以进行控制。
#### 故障注入
在不杀死服务的情况下，修改路由规则，将特定的故障注入到网络中。
原理：TCP层制造数据包的延迟和损坏。模拟服务超时和失败的场景。
## Mixer
实现策略控制与监控日志。
每一次的Proxy转发的请求都会调用Mixer.可扩展通过适配器来适配不同的平台。
调用的目的：检查合法性与上报监控信息和日志信息。
- 高可用和低延迟的实现：
   1. Proxy 本地缓存，减少Proxy对Mixer调用尽量降低服务调用的延迟。
   2.  Mixer的本地缓存。Mixer是独立运行，可以大量的使用缓存，减少对后端程序的调用。减少延迟，减少后端故障给服务带来的影响。
- Mixer实现策略控制与日志监控功能。
  1. 两类策略控制： 服务调用进行速率限制，一类是服务调用进行访问限制。在Mixer通过配置文件进行实现的。具体学习k8s操作。
  2. 监控和日志收集： 通过yaml文件进行操作具体学习k8s了解。
##  Citadel
 保证服务之间的访问安全。需要使用Proxy、Pilot以及Mixer的配合
- Citadel 存储了秘钥和证书
- Pilot把授权和安全命名信息发送给Proxy
- Proxy之间嗲用使用TLS保证安全
- Mixer管理授权和审计。


   
  


