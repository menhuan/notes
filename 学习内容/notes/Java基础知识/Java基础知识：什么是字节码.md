# Java字节码

Java字节码 是虚拟机使用的指令集，虚拟机是基于**栈**的模型来进行计算的。

## 操作数栈

### 解释执行

解释执行的过程中，虚拟机给方法分配栈帧，需要单独的开辟内存空间用来存储操作数栈，计算的操作以及返回结果。

### 常见的操作数栈的指令

#### dup

复制栈顶元素。

经常复制 初始化对象，但是未经使用的引用。

利用该命令dup指令复制一份new的结果，用来构建我们的构造器，并调用之后返回。

#### pop

舍弃栈顶元素。

舍弃调用指令返回的结果。

#### 总结

两条指令只能处理非long或者非double类型的值，因为他们需要占用两个栈单元。需要执行两次该pop和dup命令。

#### 常数指令表

通常情况下，指令集的操作都是一条条的指令，但是唯一情况时抛异常的情况。会把栈内的内存清空，再把**异常实例**放入栈中。

## 局部变量区

方法栈帧中另外一个组成部分就是局部变量区，字节码程序将结果缓存在局部变量区中。

局部变量被设计成一个数组，一次传入以下参数。

- this指针（非静态方法）
- 所传入的参数。
- 字节码中的局部变量。

### 局部变量区访问指令表

数组的加载，存储指令都需要指明所加载单元的下标。

## 字节码

指令还包含更高层次的字节码，比如new,instanceof(判断是否是目标类)，checkcast 后跟目标类，判断栈顶元素是否是目标类或者接口，

### 数组访问指令表。

控制流指令，包含条件指令，返回指令等内容。

基本类型的数组newarray，新建立的饮用型数组等内容。

### 返回指令表

返回指令外，控制流指令需要带一个或者多个字节码的偏移量，需要**调转的位置。**