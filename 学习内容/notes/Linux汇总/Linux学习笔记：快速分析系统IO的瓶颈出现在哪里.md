# 套路学习

## IO性能指标

![性能指标](http://jikelearn.cn/2019-02-21-22-31-35.png)

### 文件IO指标

1. 存储空间使用情况，容量的使用量，剩余空间。还应该注意元数据也占用磁盘空间。

2. 索引节点的使用情况，包括容量，使用量以及剩余量三个指标。

3. 缓存使用情况。包含页缓存，目录项花奴才能，索引节点缓存以及各个具体的文件系统的缓存。帮助加速访问文件系统的元数据，减少访问磁盘的次数。

4. IOPS 是r/s与w/s，相应时间，以及吞吐量B/S.

### 磁盘I/O性能指标

1. 使用率：磁盘忙处理I/O请求的百分比，超过60%通常意味着I/O瓶颈
2. IOPS: 每秒的I/O请求数
3. 吞吐量：每秒I/O的请求大小
4. 响应时间：发出I/O请求到收到响应时间的间隔时间
5. 缓冲区

   ![磁盘IO](http://jikelearn.cn/2019-02-21-22-41-58.png)

### 性能工具

1. 文件系统工具df

2. 磁盘IO系统适应iostat和pidstat。iostat 观察磁盘IO使用率，吞吐量，响应时间和IOPS指标。pidstat查看进程的I/O吞吐量以及块设备的I/O延迟。

3. strace和lsof查找问题进场问题。

4. filetop和opensnoop从内核跟中系统调用。

## 性能指标与工具的联系

![根据指标找问题](http://jikelearn.cn/2019-02-21-22-47-27.png)

![2019-02-21-22-48-03](http://jikelearn.cn/2019-02-21-22-48-03.png)

流程如下：

1. 通过iostat 定位磁盘IO瓶颈。

2. 借助pidstat 分析进程瓶颈问题。

3. 随后分析进程IO行为。

4. 结合应用程序原理，分析IO的来源。
  
![2019-02-21-22-49-52](http://jikelearn.cn/2019-02-21-22-49-52.png)  