# DNS

机器本质上都是通过IP来进行通信的，但是IP地址对于大家来说并不是可记忆的，有大量的IP地址进行通信的话，不是那么容易都能记下来。

这就出现域名DNS了，DNS就是域名系统，是互联网中最基础的一项服务，主要是用来提供**域名跟IP地址之间的映射关系**的。

还提供了动态服务发现与全局负载均衡的机制。可以让DNS来选择举例用户近的IP地址进行服务，即使后端的ip地址发生了改变，用户依然可以用相同的域名来访问。

## 域名与DNS解析

域名由一串用电分割的字符串构成。用来识别互联网中的机器名称，标识各种服务的主机位置。

域名具有层次的盖面。最下面的一层是我们经常看到的.com,.cn，.org等域名。我们经常看到都是二级域名或者三级域名等。
![2019-03-03-16-44-37](http://jikelearn.cn/2019-03-03-16-44-37.png)

jikelearn.cn 就是一个二级域名，.cn 是顶级域名，jikelearn 就是二级域名的组成。

那么ip怎么与域名对应上呢？这就需要域名解析服务DNS了，网络协议则是DNS协议。

DNS协议在TCP/IP中属于应用层，但是传输是基于UDP或者TCP协议的。端口一般是53.

在配置DNS服务器之后，我们需要配置一个域名服务器，国内一般是114.114.114.114 来使用。

在DNS的配置中，我们会看到多个选项有A、CHAME、NS等记录。记录可以参考如下图片。
![2019-03-03-20-59-22](http://jikelearn.cn/2019-03-03-20-59-22.png)

- A记录是用来将域名转换成为IP的
- CHAME记录是用来创建别名的。
- NS记录是表示域名赌赢的域名服务器地址。

## 案例学习

### DNS解析失败

使用命令 nslookup time.geekbang.org 尝试。

当连接不通的时候，可以尝试ping DNS地址查看什么问题。

或者使用 nslookup -debug time.geekbang.org 尝试显示具体信息。

dns 配置服务在linux 上为 /etc/resolv.conf 地址。

### DNS解析不稳定

使用如上命令解析指定域名，时间延迟很长。

三种情景导致解析缓慢
  
- DNS服务器自己有问题。
- 客户端到DNS服务器的网络延迟不稳定
- DNS请求或者响应包在某些情况下被链路中的设备丢失了

还有就是缓存，我们需要为DNS开起缓存，这样的话就不用每次都去请求DNS服务器发现资源。

方式是 dnsmasq

```Linux
/etc/init.d/dnsmasq start

echo nameserver 127.0.0.1 > /etc/resolv.conf 中
```
