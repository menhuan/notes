# MQ的使用场景

越来越多的应用会使用到MQ,那MQ到底是什么？我们拿经常使用的RabbitMQ来举例说明。

MQ简单的说就是一个队列，在Java或者Python都有自己内部的队列实现，但是这些队列都属于单机版，只能自己内部使用无法共享，
而RabbitMQ这些消息队列单独作为一个服务向外提供服务，很多应用都可以向使用数据库一样使用MQ(消息队列了)。

那应用中什么时候需要使用到MQ呢？主要是下面三个场景

## 异步调用

现实生活中总会有很多这样的场景，比如刚注册一个网站，需要接收手机验证码，邮箱验证码。如果做成同步应用，如果所示消耗时间，那么对于用户来说一个请求等待时间过长体验并不好。

![同步调用](http://jikelearn.cn/2019-10-24-22-52-43.png)

做成异步调用后，很快相应用户，对于用户来讲，感知网站速度很快，等待短信通知就是可等待的。相应网站的时间就由原先的几十秒缩短为60ms，体验提升了很高。

![异步调用](http://jikelearn.cn/2019-10-24-22-55-55.png)

当然也可以设置成异步调用发送短信，异步调用发送邮件等消息内容。
![异步调用多个服务](http://jikelearn.cn/2019-10-24-22-57-49.png)

## 应用解耦

微服务在互联网市场上很火爆，微服务可以通过Grpc进行通信，也可以通过MQ来进行通信达到应用之间的解耦。

比如说京东有自己的物流，在京东成功下单后将订单发送到物流系统，进行派发。但如果将物理系统与下单系统耦合在一起，物流系统出现故障，导致用户下单失败。那这么解决呢？
使用MQ，MQ有消息持久化的功能，物流系统失败，消息不会被消费，可以存在消息队列汇总。解决物流系统后应用内消息还可以继续消费。
![2019-10-24-23-06-13](http://jikelearn.cn/2019-10-24-23-06-13.png)

## 流量削峰

toC业务中经常会有秒杀的活动，这种活动特性是流量大，同一时刻请求数大，但为了保证系统的可用，以及排除一些黑名单用户，这时候可以在前端系统汇总引入消息队列的概念。

比如说这次活动销售量是1000个商品，也就是接受1000个请求。

方法是直接设置一个系统中设置的固定人数，达到队列最大长度后，后面的请求直接抛弃，秒杀结束或者其他指定页面。


![2019-10-24-23-14-30](http://jikelearn.cn/2019-10-24-23-14-30.png)

## 总结

介绍MQ应用场景，明白什么时候用MQ，等业务需要的时候就可以引入该中间件，已达到提高系统的高可用性。

本文内容同步发送到github中，链接地址是：https://github.com/menhuan/notes